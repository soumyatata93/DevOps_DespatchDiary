import{f as C,V as N,C as g,h as f,g as u,D as U,E as q,A as B,r as v,o as p,c as R,w as n,d as _,a,u as l,e as y,k as x,t as D,F as w,b as T}from"./app.40bb12c6.js";import{h as E}from"./moment.9709ab41.js";const I=C("EditVehicleStore",{state:()=>({vehicleForm:"",id:"",validationError:!1,branches_fix:!0,branches:[],branches_data:[],vehiclestatus:[{index:0,name:"Not Active"},{index:1,name:"Active"},{index:2,name:"Inservice"},{index:3,name:"Accident or Repair"}],vehicleForm1:{van_number:"",start_date:"",end_date:"",branch_id:"",shipping_agent_service_code:"",delivery_capacity:"",target_amount:"",registration_number:"",vehicle_type:"",vehicle_status:"",display_order:""},previousVehicleStatus:""}),actions:{setBranches(){this.branches_fix=!1,this.branches_data=N.getCookie("branch_list"),this.branches_data=JSON.parse(this.branches_data),this.branches_data.forEach((o,e,m)=>{this.branches.push({branch_id:o.branch_id,branch_location:o.branch_location})})},async updateVehicleDetails(o){if(this.vehicleStatusEndDateCheck(),!this.validationError){this.controller&&this.controller.abort(),this.controller=new AbortController;const e=this.controller.signal,d=g.exports.useLoading().show({color:"#5D2296",loader:"dots"});await f.post("/api/update-vehicle",{vehicleForm:this.vehicleForm1,vehicleId:o},{signal:e}).then(s=>{setTimeout(()=>{d.hide()},100),s.data!=""?u.fire({title:"Updated sucessfully!",icon:"success"}):u.fire({title:"Record not saved",text:"Error in Database",icon:"warning"})}).catch(function(s){s.name==="AbortError"&&console.log("Request canceled",s.name)})}},deleteVehicle(o){u.fire({title:"Delete this record?",showDenyButton:!0,confirmButtonText:"Yes",denyButtonText:"No",text:"Are you sure? Once deleted you won't be able to recover this!",icon:"warning"}).then(e=>{if(e.isConfirmed){this.controller&&this.controller.abort(),this.controller=new AbortController;const m=this.controller.signal,s=g.exports.useLoading().show({color:"#5D2296",loader:"dots"});f.post("/api/delete-vehicle",{vehicleId:o},{signal:m}).then(c=>{setTimeout(()=>{s.hide()},100),c.data!=""?u.fire({title:"Vehicle record deleted sucessfully!",icon:"success"}).then(V=>{U.push({name:"vehicle"})}):u.fire({title:"Record not deleted",text:"Error in Database",icon:"warning"})})}else u.fire("Your vehicle record is not Deleted, its safe!")}).catch(function(e){setTimeout(()=>{loader.hide()},100),e.name==="AbortError"&&console.log("Request canceled",e.name)})},async InitializeEditVehicle(o){let e=o;this.controller&&this.controller.abort(),this.controller=new AbortController;const m=this.controller.signal,s=g.exports.useLoading().show({color:"#5D2296",loader:"dots"});await f.post("/api/edit-vehicle",{vehicleId:e},{signal:m}).then(c=>{this.vehicleForm=c.data,setTimeout(()=>{s.hide()},100),this.vehicleForm1.van_number=this.vehicleForm[0].van_number,this.vehicleForm1.start_date=E(this.vehicleForm[0].start_date).format("yyyy-MM-DD"),this.vehicleForm1.end_date=E(this.vehicleForm[0].end_date).format("yyyy-MM-DD"),this.vehicleForm1.branch_id=this.vehicleForm[0].branch_id,this.vehicleForm1.shipping_agent_service_code=this.vehicleForm[0].shipping_agent_service_code,this.vehicleForm1.delivery_capacity=this.vehicleForm[0].delivery_capacity,this.vehicleForm1.target_amount=this.vehicleForm[0].target_amount,this.vehicleForm1.registration_number=this.vehicleForm[0].registration_number,this.vehicleForm1.vehicle_type=this.vehicleForm[0].vehicle_type,this.vehicleForm1.vehicle_status=this.vehicleForm[0].vehicle_status,this.vehicleForm1.display_order=this.vehicleForm[0].display_order,this.previousVehicleStatus=this.vehicleForm1.vehicle_status}).catch(function(c){setTimeout(()=>{s.hide()},100),c.name==="AbortError"&&console.log("Request canceled",c.name)})},vehicleStatusEndDateCheck(){if(this.previousVehicleStatus==0&&this.vehicleForm1.vehicle_status==1){let o=new Date().toISOString().slice(0,10);this.vehicleForm1.end_date<=o?(u.fire({title:"Issue in end date",text:"End date must be greater than current date",icon:"warning"}),this.validationError=!0):this.validationError=!1}}},getters:{getbranches_fix(o){return o.branches_fix}}}),$=_("br",null,null,-1),L=_("span",{class:"arrow_styles material-icons"},"arrow_back",-1),M=_("h1",{class:"text-center"}," Vehicle Update",-1),O=_("hr",null,null,-1),W=["value"],X=["value"],z=T("Delete "),Z={__name:"EditVehicle",setup(o){const e=I();e.getbranches_fix==!0&&e.setBranches();let d=q().query.id;const s=()=>{e.updateVehicleDetails(d)},c=V=>{e.vehicleStatusEndDateCheck()};return B(()=>{e.InitializeEditVehicle(d)}),(V,i)=>{const A=v("router-link"),h=v("b-col"),F=v("b-row"),r=v("FormKit"),S=v("b-form-row"),k=v("b-container");return p(),R(k,{fluid:"",class:"screenLayoutsWidth"},{default:n(()=>[_("div",null,[$,a(F,{style:{"margin-top":"55px"}},{default:n(()=>[a(h,{cols:"4"},{default:n(()=>[a(A,{to:"/vehicle",class:"btn btn-primary"},{default:n(()=>[L]),_:1})]),_:1}),a(h,{cols:"3",class:"headingAdjust"},{default:n(()=>[M]),_:1}),a(h,{cols:"5"})]),_:1})]),O,a(S,{class:"editVehicleForm"},{default:n(()=>[a(r,{type:"form",onSubmit:s},{default:n(()=>[a(F,null,{default:n(()=>[a(h,{cols:"2"}),a(h,{cols:"4"},{default:n(()=>[a(r,{type:"text",name:"van-number",label:"Van Number",help:"Van number should have a prefix of VAN,Ex: if the shipping agent service code is VAN123RUN1,the Van number must be VAN123",validation:"required|alphanumeric|length:5,10",placeholder:"VANXXX",modelValue:l(e).vehicleForm1.van_number,"onUpdate:modelValue":i[0]||(i[0]=t=>l(e).vehicleForm1.van_number=t)},null,8,["modelValue"]),a(r,{type:"date",name:"start-date",label:"Start Date",placeholder:"dd-mm-yyyy",help:"Date when van came into service",modelValue:l(e).vehicleForm1.start_date,"onUpdate:modelValue":i[1]||(i[1]=t=>l(e).vehicleForm1.start_date=t)},null,8,["modelValue"]),a(r,{type:"select",name:"branch-name",label:"Branch Name",validation:"required",placeholder:"Bedford",modelValue:l(e).vehicleForm1.branch_id,"onUpdate:modelValue":i[2]||(i[2]=t=>l(e).vehicleForm1.branch_id=t),help:"Which branch is this van has to serve"},{default:n(()=>[(p(!0),y(w,null,x(l(e).branches,(t,b)=>(p(),y("option",{id:"searchDropdown",key:b,value:t.branch_id},D(t.branch_location),9,W))),128))]),_:1},8,["modelValue"]),a(r,{type:"text",name:"target-amount",label:"Target Amount",placeholder:"10000.00",validation:"required|length:3,10",modelValue:l(e).vehicleForm1.target_amount,"onUpdate:modelValue":i[3]||(i[3]=t=>l(e).vehicleForm1.target_amount=t),help:"Daily target amount for delivery"},null,8,["modelValue"]),a(r,{type:"text",name:"registration-number",label:"Registration Number",placeholder:"AB12 CDE",validation:"required|matches:/^[A-Z]{2}[0-9]{2}\\s[A-Z]{3}$/",help:"Registration number of the vehicle. Remember to add space between",modelValue:l(e).vehicleForm1.registration_number,"onUpdate:modelValue":i[4]||(i[4]=t=>l(e).vehicleForm1.registration_number=t)},null,8,["modelValue"]),a(r,{type:"number",name:"display-order",label:"Display Order",validation:"required",modelValue:l(e).vehicleForm1.display_order,"onUpdate:modelValue":i[5]||(i[5]=t=>l(e).vehicleForm1.display_order=t)},null,8,["modelValue"])]),_:1}),a(h,{cols:"4"},{default:n(()=>[a(r,{type:"text",name:"shipping-agent-service-code",label:"Shipping Agent Service Code",modelValue:l(e).vehicleForm1.shipping_agent_service_code,"onUpdate:modelValue":i[6]||(i[6]=t=>l(e).vehicleForm1.shipping_agent_service_code=t),help:"Van Number-Nav vehicle code",placeholder:"VAN123",validation:"required|alphanumeric|length:5,12"},null,8,["modelValue"]),a(r,{type:"date",name:"end-date",label:"End Date",placeholder:"dd/mm/yyyy",help:"Date when will van went out of service",modelValue:l(e).vehicleForm1.end_date,"onUpdate:modelValue":i[7]||(i[7]=t=>l(e).vehicleForm1.end_date=t)},null,8,["modelValue"]),a(r,{type:"text",name:"vehicle-type",label:"Vehicle Type",placeholder:"7.5T Flat Bed",validation:"required|length:0,35",modelValue:l(e).vehicleForm1.vehicle_type,"onUpdate:modelValue":i[8]||(i[8]=t=>l(e).vehicleForm1.vehicle_type=t),help:"What type of vehicle is it"},null,8,["modelValue"]),a(r,{type:"number",name:"delivery-capacity",label:"Delivery Capacity",placeholder:"1000",validation:"required",modelValue:l(e).vehicleForm1.delivery_capacity,"onUpdate:modelValue":i[9]||(i[9]=t=>l(e).vehicleForm1.delivery_capacity=t),help:"Delivery capacity in kg"},null,8,["modelValue"]),a(r,{type:"select",name:"vehicle-status",label:"Vehicle Status",validation:"required",modelValue:l(e).vehicleForm1.vehicle_status,"onUpdate:modelValue":i[10]||(i[10]=t=>l(e).vehicleForm1.vehicle_status=t),onChange:c},{default:n(()=>[(p(!0),y(w,null,x(l(e).vehiclestatus,(t,b)=>(p(),y("option",{id:"searchDropdown",key:b,value:b},D(t.name),9,X))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,{cols:"2"})]),_:1})]),_:1}),a(r,{type:"button",onClick:i[11]||(i[11]=t=>l(e).deleteVehicle(l(d)))},{default:n(()=>[z]),_:1})]),_:1})]),_:1})}}};export{Z as default};
